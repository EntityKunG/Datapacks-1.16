# detect structure block
execute if entity @s[nbt={Item:{id:"minecraft:nether_star",Count:1b}}] unless entity @e[type=area_effect_cloud,tag=mob_despawner,distance=..64] if entity @e[type=item,nbt={Item:{id:"minecraft:diamond_sword"}},limit=1,distance=..0.5] if block ~ ~-1 ~ end_rod[facing=down] if block ~ ~-2 ~ end_rod[facing=up] if block ~ ~-3 ~ iron_block if block ~ ~-4 ~ emerald_block run function stevekung:mob_despawner/summon_despawner

# detect mini structure block
execute if entity @s[nbt={Item:{id:"minecraft:nether_star",Count:1b}}] unless entity @e[type=area_effect_cloud,tag=mini_mob_despawner,distance=..32] if entity @e[type=item,nbt={Item:{id:"minecraft:iron_sword"}},limit=1,distance=..0.5] if block ~ ~-1 ~ iron_bars if block ~ ~-2 ~ iron_bars if block ~ ~-3 ~ iron_block if block ~ ~-4 ~ gold_block run function stevekung:mob_despawner/summon_mini_despawner

# check if despawner is nearby
execute if entity @s[nbt={Item:{id:"minecraft:nether_star",Count:1b}}] if entity @e[type=area_effect_cloud,tag=mob_despawner,distance=..64] if entity @e[type=item,nbt={Item:{id:"minecraft:diamond_sword"}},limit=1,distance=..0.5] if block ~ ~-1 ~ end_rod[facing=down] if block ~ ~-2 ~ end_rod[facing=up] if block ~ ~-3 ~ iron_block if block ~ ~-4 ~ emerald_block run title @a[distance=..8] actionbar {"text":"Cannot build! Other nearby mob despawner detected.","color":"red"}

execute if entity @s[nbt={Item:{id:"minecraft:nether_star",Count:1b}}] if entity @e[type=area_effect_cloud,tag=mini_mob_despawner,distance=..32] if entity @e[type=item,nbt={Item:{id:"minecraft:iron_sword"}},limit=1,distance=..0.5] if block ~ ~-1 ~ iron_bars if block ~ ~-2 ~ iron_bars if block ~ ~-3 ~ iron_block if block ~ ~-4 ~ gold_block run title @a[distance=..8] actionbar {"text":"Cannot build! Other nearby mini mob despawner detected.","color":"red"}